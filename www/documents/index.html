---
layout: default
title: Complete Discography
center_title: true
hide_sidebar: true
---
  <link href="lib/sortable-0.8.0/css/sortable-theme-bootstrap.css" rel="stylesheet" type="text/css" />
  <link href="css/style.css" rel="stylesheet" type="text/css" />

  <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script> 
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
  <script type="text/javascript" src="lib/sortable-0.8.0/js/sortable.js"></script> 
  <script>
    const SUBMIT_BTN_INIT_TEXT = "Go!"
    const SUBMIT_BTN_LOADING_TEXT = "Loading..."
    var artist
    socket = io("wss://"+window.location.hostname+"/discography")
    socket.on("release_rows", function(data) {
      console.log("release_rows")
      init_disco(true)
      $("#disco").append(data)
    })

    socket.on("complete", function() {
      console.log("complete")
      $("#loading").hide()
      makeTableSortable(true)
      init_disco(false) // cover the case of 0 rows
    })

    $(function () {
      $("#artist").on('input', correctButtonEnablement)
      correctButtonEnablement()
    })

    function correctButtonEnablement() {
      $("#submit").prop('disabled', $("#artist").val().length == 0)
    }

    function get_discography(e) {
      e.preventDefault()
      artist = $("#artist").val()
      let btnText = $("#submit").html()
      $("#submit").html(SUBMIT_BTN_LOADING_TEXT)
      $("#submit").prop('disabled', true)
      $("#artist-container").hide()
      $("#disco-container").hide()
      $("#disco").empty()
      $("#loading").show()
      console.log("socket emit get '"+artist+"'")
      socket.emit("get", artist)
      return false;
    }

    /*
     * Initialize the discography display area
     *
     * results_found: boolean indicating if results were found
    */
    function init_disco(results_found) {
      if ($("#submit").prop('disabled') == false) {
        return false
      }
      if (results_found) {
        $("#results-heading").html("Complete Discography for "+artist)
        makeTableSortable(false)
        $("#disco-table").show()
      } else {
        $("#results-heading").html("No results found.")
        $("#disco-table").hide()
      }
      $("#submit").html(SUBMIT_BTN_INIT_TEXT)
      $("#submit").prop('disabled', false)
      $("#disco-container").show()
    }

    function makeTableSortable(enable=false) {
      $("#disco-head tr th").each(function() {
        $(this).attr("data-sortable", enable) // css looks at this value
        $(this).removeAttr("data-sorted")
        $(this).removeAttr("data-sorted-direction")
      })

      if (enable) {
        $("#disco-table").removeAttr("data-sortable-initialized")
        Sortable.init()
      } else { 
        // remove event listeners!
        $("#disco-head").html($("#disco-head").html())
      }
    }
  </script>

  <div class="center-contents">
    <div class="center-flex center-contents big-bottom">
      <p>If you follow an artist who performs in several different bands, this tool is for you. 
        Enter their name to get a list of every album they've released under all of their various bands and aliases.</p>
      <p>This app uses Python and Flask to retrieve data from <a href="https://discogs.com">Discogs.com</a>.
        Check out the source code on <a href="https://github.com/dfunklove/complete-discography">GitHub</a>.</p>
      <form class="center-contents" onsubmit="get_discography(event)">
        <label for="artist">Artist Name</label><br>
        <input type="text" class="center-contents" id="artist" size="45"><br>
        <input type="submit" class="btn btn-primary btn-lg" id="submit" disabled="true" value="GO">
      </form>
    </div>
    <div id="artist-container" class="hidden spacey">
      <h2>Please choose your artist.</h2>
      <div id="artist-list" class="center-me limit-width"></div>
    </div>
    <div id="disco-container" class="hidden spacey jumbotron-background">
      <div class="center-me center-contents">
        <h2 id="results-heading" class="text-success">Results</h2>
        <table id="disco-table" class="center-me little-spacey sortable" data-sortable>
          <thead id="disco-head">
            <tr><th>&nbsp;</th><th>Artist</th><th>Title</th><th>Label</th><th>Year</th></tr>
          </thead>
          <tbody id="disco"></tbody>
        </table>
      </div>
    </div>
    <div id="loading" class="hidden">
      <img src="images/spinner.svg"/>
    </div>
    <div class="big-bottom"></div>
  </div>
